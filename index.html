<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weather App ‚Äî Enhanced</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg: #0f172a;
      --card: #0b1220;
      --accent: #06b6d4;
      --muted: #94a3b8;
      --glass: rgba(255,255,255,0.03);
      --success: #16a34a;
      --warn: #f59e0b;
      --danger: #ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg, #071029 0%, #07122a 60%);
      color:#e6eef7;
      padding:18px;
    }

    .app{
      width:100%;
      max-width:980px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      padding:18px;
      box-shadow:0 8px 30px rgba(2,6,23,0.6);
      border:1px solid rgba(255,255,255,0.03);
      position:relative;
      overflow:hidden;
    }

    header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    form{
      display:flex;
      gap:8px;
      margin-top:12px;
      align-items:center;
    }
    input[type="text"]{
      flex:1;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.05);
      background:var(--glass);
      color:inherit;
      font-size:15px;
    }
    .controls{display:flex;gap:8px;align-items:center}
    button{
      padding:10px 12px;
      border-radius:10px;
      border:0;
      background:linear-gradient(90deg,var(--accent),#7dd3fc);
      color:#04202a;
      font-weight:600;
      cursor:pointer;
    }
    .icon-btn{
      padding:8px 10px;
      background:rgba(255,255,255,0.02);
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.02);
      color:var(--muted);
      cursor:pointer;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:18px;
      margin-top:16px;
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
      padding:16px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.025);
    }

    .main-weather{
      display:flex;
      gap:18px;
      align-items:center;
    }
    .temp {font-size:48px; font-weight:700}
    .cond{font-size:16px;color:var(--muted)}
    .recommend{margin-top:12px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:14px}

    .meta{display:flex;gap:12px;margin-top:12px;flex-wrap:wrap}
    .meta .item{background:rgba(255,255,255,0.02);padding:8px 10px;border-radius:8px;font-size:13px}

    .right-col{display:flex;flex-direction:column;gap:12px}
    .small{font-size:13px;color:var(--muted)}

    .aqi{display:flex;gap:8px;align-items:center}
    .aqi .dot{width:14px;height:14px;border-radius:50%}

    .loading{opacity:0.95;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:14px}

    .note{color:var(--muted);font-size:13px;margin-top:8px}

    footer{margin-top:14px;text-align:right;color:var(--muted);font-size:12px}

    /* forecast chart */
    #forecastChart { width:100%; height:220px; }

    /* simple animations overlay */
    .weather-anim{
      position:absolute; left:0; right:0; top:0; bottom:0; pointer-events:none; z-index:0;
    }
    .anim-layer{position:absolute; inset:0; z-index:0; overflow:hidden;}
    /* day/night overlay tint */
    .anim-layer.day { background: linear-gradient(180deg, rgba(255,255,255,0.00), rgba(255,255,255,0.00)); mix-blend-mode:overlay; }
    .anim-layer.night { background: linear-gradient(180deg, rgba(2,6,23,0.0), rgba(2,6,23,0.35)); }

    /* rain */
    .rain { --drops:60; position:absolute; inset:0; }
    .raindrop {
      position:absolute;
      top:-10%;
      width:2px;
      height:14px;
      opacity:0.6;
      background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.15));
      transform:translateY(-100%) rotate(-10deg);
      animation:fall linear;
    }
    @keyframes fall{
      to { transform:translateY(120vh) rotate(-10deg); opacity:0.1; }
    }

    /* snow */
    .snow { position:absolute; inset:0; }
    .flake {
      position:absolute;
      top:-5%;
      width:8px;
      height:8px;
      background:rgba(255,255,255,0.9);
      border-radius:50%;
      opacity:0.9;
      filter:blur(0.2px);
      animation:drift linear;
    }
    @keyframes drift{ to { transform:translateY(120vh) translateX(20vw); opacity:0.6; } }

    /* responsive */
    @media (max-width:920px){
      .grid{grid-template-columns:1fr;}
      .right-col{order:2}
    }

    /* translation select */
    .lang-select{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:6px 8px;border-radius:8px;color:var(--muted)}
    /* small helper */
    .row{display:flex;gap:8px;align-items:center}
    .muted{color:var(--muted);font-size:13px}
    .speech-active{background:linear-gradient(90deg,#ffd166,#ff8b8b);color:#04202a}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div>
        <h1 id="title">Weather App</h1>
        <p class="lead" id="lead">Type a city, ZIP/postal code or coordinates (lat,lon) and press Search.</p>
      </div>

      <div class="row">
        <select id="lang" class="lang-select" title="Language">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        </select>
        <div class="muted" id="powered">Powered by WeatherAPI</div>
      </div>
    </header>

    <form id="searchForm">
      <input id="locationInput" type="text" placeholder="e.g. London or 10001 or 48.8566,2.3522" value="London" required />
      <div class="controls">
        <button type="submit" id="searchBtn">Search</button>
        <button type="button" id="geoBtn" class="icon-btn" title="Use current location">Use my location</button>
        <button type="button" id="voiceBtn" class="icon-btn" title="Voice search">üéôÔ∏è</button>
      </div>
    </form>

    <div class="grid">
      <div class="card" id="resultCard" style="position:relative;z-index:2">
        <div id="loading" class="loading" style="display:none">Loading...</div>

        <div id="main" style="display:none">
          <div class="main-weather">
            <div>
              <div class="temp" id="tempC">--¬∞C</div>
              <div class="cond" id="conditionText">--</div>
            </div>
            <div style="margin-left:auto;text-align:center">
              <img id="condIcon" src="" alt="icon" width="96" height="96" style="image-rendering:pixelated;" />
              <div class="small" id="localTime">Local time: --</div>
            </div>
          </div>

          <div class="meta">
            <div class="item">Feels like: <strong id="feelslike">--¬∞C</strong></div>
            <div class="item">Humidity: <strong id="humidity">--%</strong></div>
            <div class="item">Wind: <strong id="wind">-- kph</strong></div>
            <div class="item">Visibility: <strong id="vis">-- km</strong></div>
            <div class="item">UV index: <strong id="uv">--</strong></div>
            <div class="item">Cloud: <strong id="cloud">--%</strong></div>
          </div>

          <div style="margin-top:12px">
            <strong id="locationName">--</strong>
            <div class="note" id="lastUpdated">--</div>
          </div>

          <div class="recommend" id="recommendations" style="display:none"></div>
        </div>
      </div>

      <div class="right-col">
        <div class="card" id="airCard" style="display:none">
          <h3 style="margin-top:0;margin-bottom:8px" id="aqTitle">Air Quality</h3>
          <div id="aqContent"></div>
        </div>

        <div class="card">
          <h3 style="margin-top:0;margin-bottom:8px" id="extraTitle">Extra Info</h3>
          <div class="small">Timezone: <strong id="tz">--</strong></div>
          <div class="small">Lat/Lon: <strong id="latlon">--</strong></div>
          <div class="small">Region/Country: <strong id="region">--</strong></div>
        </div>

        <div class="card" id="forecastCard">
          <h3 style="margin-top:0;margin-bottom:8px" id="forecastTitle">7-day Forecast</h3>
          <canvas id="forecastChart"></canvas>
          <div class="small muted" id="chartNote">Max / Min temps shown</div>
        </div>
      </div>
    </div>

    <footer id="footerNote">Tip: you can enter coordinates like "12.9716,77.5946" for Bangalore.</footer>

    <!-- animations overlay -->
    <div class="weather-anim" id="animLayer" aria-hidden="true"></div>
  </div>

  <script>
    /* ============================
       Configuration & Translations
       ============================ */
    const API_KEY = '1ce0281545db48568c6150513252911'; // replace if you want your own key for public use
    const BASE_CURRENT = 'https://api.weatherapi.com/v1/current.json';
    const BASE_FORECAST = 'https://api.weatherapi.com/v1/forecast.json';

    const translations = {
      en: {
        title: "Weather App",
        lead: "Type a city, ZIP/postal code or coordinates (lat,lon) and press Search.",
        powered: "Powered by WeatherAPI",
        aqTitle: "Air Quality",
        extraTitle: "Extra Info",
        forecastTitle: "7-day Forecast",
        forecastNote: "Max / Min temps shown",
        useLocation: "Using your current location...",
        geoFail: "Could not get your location. Please allow location access.",
        voiceNotSupported: "Voice search not supported in this browser.",
        listening: "Listening...",
        searchPlaceholder: 'e.g. London or 10001 or 48.8566,2.3522',
        tip: 'Tip: you can enter coordinates like "12.9716,77.5946" for Bangalore.',
        lastUpdatedPrefix: 'Last updated: '
      },
      hi: {
        title: "‡§Æ‡•å‡§∏‡§Æ ‡§ê‡§™",
        lead: "‡§ï‡§ø‡§∏‡•Ä ‡§∂‡§π‡§∞, ‡§™‡§ø‡§®/‡§ú‡§º‡§ø‡§™ ‡§Ø‡§æ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡§æ‡§Ç‡§ï (lat,lon) ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ Search ‡§¶‡§¨‡§æ‡§è‡§Å‡•§",
        powered: "WeatherAPI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§",
        aqTitle: "‡§µ‡§æ‡§Ø‡•Å ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ",
        extraTitle: "‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
        forecastTitle: "7-‡§¶‡§ø‡§® ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®",
        forecastNote: "‡§¶‡§ø‡§ñ‡§æ‡§è ‡§ó‡§è ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ / ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ‡§§‡§æ‡§™‡§Æ‡§æ‡§®",
        useLocation: "‡§Ü‡§™‡§ï‡§æ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡•ç‡§∞‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...",
        geoFail: "‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§≤‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§æ ‚Äî ‡§ï‡•É‡§™‡§Ø‡§æ ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§Ç‡•§",
        voiceNotSupported: "‡§Ø‡§π ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§µ‡•â‡§á‡§∏ ‡§∏‡§∞‡•ç‡§ö ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§",
        listening: "‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•à...",
        searchPlaceholder: '‡§â‡§¶‡§æ. London ‡§Ø‡§æ 10001 ‡§Ø‡§æ 48.8566,2.3522',
        tip: '‡§ü‡§ø‡§™: ‡§¨‡•à‡§Ç‡§ó‡§≤‡•ã‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è "12.9716,77.5946" ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§',
        lastUpdatedPrefix: '‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•Å‡§Ü: '
      }
    };

    let lang = 'en';
    function t(key){ return translations[lang][key] ?? translations['en'][key] ?? key; }

    // Elements
    const form = document.getElementById('searchForm');
    const input = document.getElementById('locationInput');
    const loadingEl = document.getElementById('loading');
    const mainEl = document.getElementById('main');
    const airCard = document.getElementById('airCard');
    const animLayer = document.getElementById('animLayer');
    const recommendationsEl = document.getElementById('recommendations');
    const forecastCard = document.getElementById('forecastCard');
    const forecastChartCtx = document.getElementById('forecastChart').getContext('2d');
    let forecastChart = null;

    // UI elements for translations
    const titleEl = document.getElementById('title');
    const leadEl = document.getElementById('lead');
    const poweredEl = document.getElementById('powered');
    const aqTitleEl = document.getElementById('aqTitle');
    const extraTitleEl = document.getElementById('extraTitle');
    const forecastTitleEl = document.getElementById('forecastTitle');
    const chartNoteEl = document.getElementById('chartNote');
    const footerNote = document.getElementById('footerNote');

    // controls
    const geoBtn = document.getElementById('geoBtn');
    const voiceBtn = document.getElementById('voiceBtn');
    const langSelect = document.getElementById('lang');

    function applyTranslations(){
      titleEl.textContent = t('title');
      leadEl.textContent = t('lead');
      poweredEl.textContent = t('powered');
      aqTitleEl.textContent = t('aqTitle');
      extraTitleEl.textContent = t('extraTitle');
      forecastTitleEl.textContent = t('forecastTitle');
      chartNoteEl.textContent = t('forecastNote');
      input.placeholder = t('searchPlaceholder');
      footerNote.textContent = t('tip');
    }

    applyTranslations();

    langSelect.addEventListener('change', e => {
      lang = e.target.value;
      applyTranslations();
    });

    /* ============================
       Helper UI functions
       ============================ */
    function showLoading(show, msg){
      loadingEl.style.display = show ? 'block' : 'none';
      if(msg) loadingEl.textContent = msg;
      if(show){ mainEl.style.display = 'none'; airCard.style.display = 'none'; forecastCard.style.opacity = '0.5'; }
      else { forecastCard.style.opacity = '1'; }
    }
    function showError(msg){
      mainEl.style.display = 'block';
      document.getElementById('tempC').textContent = '--¬∞C';
      document.getElementById('conditionText').textContent = msg;
      document.getElementById('condIcon').src = '';
      document.getElementById('lastUpdated').textContent = '';
      airCard.style.display = 'none';
      recommendationsEl.style.display = 'none';
      clearAnimations();
      if(forecastChart){ forecastChart.destroy(); forecastChart = null; }
    }

    function setAQIColor(val){
      if(val <= 50) return '#16a34a';
      if(val <= 100) return '#f59e0b';
      if(val <= 150) return '#f97316';
      if(val <= 200) return '#ef4444';
      if(val <= 300) return '#9f1239';
      return '#6b21a8';
    }

    /* ============================
       Animations: rain / snow / day-night
       ============================ */
    function clearAnimations(){
      animLayer.innerHTML = '';
      animLayer.className = 'weather-anim';
    }

    function makeRain(intensity = 60){
      clearAnimations();
      const layer = document.createElement('div');
      layer.className = 'anim-layer';
      const rain = document.createElement('div');
      rain.className = 'rain';
      // create raindrops
      for(let i=0;i<intensity;i++){
        const d = document.createElement('div');
        d.className = 'raindrop';
        // random left, duration
        const left = Math.random()*100;
        const delay = Math.random()*-5;
        const dur = 0.8 + Math.random()*0.9;
        d.style.left = left + 'vw';
        d.style.animationDuration = dur + 's';
        d.style.animationDelay = delay + 's';
        rain.appendChild(d);
      }
      layer.appendChild(rain);
      animLayer.appendChild(layer);
    }

    function makeSnow(count = 30){
      clearAnimations();
      const layer = document.createElement('div');
      layer.className = 'anim-layer';
      const snow = document.createElement('div');
      snow.className = 'snow';
      for(let i=0;i<count;i++){
        const f = document.createElement('div');
        f.className = 'flake';
        const left = Math.random()*100;
        const delay = Math.random()*-5;
        const dur = 4 + Math.random()*6;
        f.style.left = left + 'vw';
        f.style.width = (4 + Math.random()*8) + 'px';
        f.style.height = f.style.width;
        f.style.opacity = (0.6 + Math.random()*0.4);
        f.style.animationDuration = dur + 's';
        f.style.animationDelay = delay + 's';
        snow.appendChild(f);
      }
      layer.appendChild(snow);
      animLayer.appendChild(layer);
    }

    function setDayNight(is_day){
      // is_day: 1 => day, 0 => night
      if(is_day){
        animLayer.classList.remove('night'); animLayer.classList.add('day');
        document.documentElement.style.setProperty('--accent','#06b6d4');
      } else {
        animLayer.classList.remove('day'); animLayer.classList.add('night');
        document.documentElement.style.setProperty('--accent','#7c3aed');
      }
    }

    /* ============================
       Smart Recommendations Logic
       ============================ */
    function computeRecommendations(data){
      // data: forecast + current + air quality
      const lists = [];
      const cur = data.current;
      const cond = (cur.condition.text || '').toLowerCase();
      const temp = cur.temp_c;
      const uv = cur.uv ?? 0;
      const wind_kph = cur.wind_kph ?? 0;
      const humidity = cur.humidity ?? 0;
      const aqi = (cur.air_quality && (cur.air_quality['us-epa-index'] || cur.air_quality['gb-defra-index'])) ?? null;

      // Clothing suggestions
      if(temp <= 5) lists.push(lang === 'hi' ? '‡§¨‡§π‡•Å‡§§ ‡§†‡§Ç‡§° ‚Äî ‡§≠‡§æ‡§∞‡•Ä ‡§ï‡•ã‡§ü ‡§™‡§π‡§®‡•á‡§Ç' : 'Very cold ‚Äî wear a heavy coat.');
      else if(temp <= 15) lists.push(lang === 'hi' ? '‡§†‡§Ç‡§°‡§æ ‚Äî ‡§ú‡•à‡§ï‡•á‡§ü ‡§∞‡§ñ‡•á‡§Ç' : 'Chilly ‚Äî keep a jacket.');
      else if(temp <= 24) lists.push(lang === 'hi' ? '‡§π‡§≤‡•ç‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ ‚Äî ‡§Ü‡§∞‡§æ‡§Æ‡§¶‡§æ‡§Ø‡§ï ‡§ï‡§™‡§°‡§º‡•á' : 'Mild ‚Äî wear comfortable clothes.');
      else lists.push(lang === 'hi' ? '‡§ó‡§∞‡•ç‡§Æ ‚Äî ‡§π‡§≤‡•ç‡§ï‡•á ‡§ï‡§™‡§°‡§º‡•á ‡§î‡§∞ ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Å' : 'Hot ‚Äî wear light clothes and stay hydrated.');

      // Rain / umbrella
      if(cond.includes('rain') || cond.includes('shower') || cond.includes('drizzle') || cond.includes('thunder')){
        lists.push(lang === 'hi' ? '‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‚Äî ‡§õ‡§æ‡§§‡§æ/‡§∞‡•á‡§®‡§ï‡•ã‡§ü ‡§∏‡§æ‡§• ‡§∞‡§ñ‡•á‡§Ç' : 'Rain expected ‚Äî carry an umbrella/raincoat.');
      } else {
        // check forecast precipitation probability if available
        try{
          const today = data.forecast?.forecastday?.[0];
          if(today){
            const willRain = today.hour?.some(h => h.chance_of_rain > 40 || h.chance_of_snow > 40);
            if(willRain) lists.push(lang === 'hi' ? '‡§Ü‡§ú ‡§ï‡•Å‡§õ ‡§Æ‡•å‡§∏‡§Æ-‡§µ‡§ø‡§ï‡§≤‡•ç‡§™‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§ï‡§æ ‡§Ö‡§Ç‡§¶‡•á‡§∂‡§æ ‡§π‡•à' : 'Rain likely today at times ‚Äî pack an umbrella just in case.');
          }
        }catch(e){}
      }

      // UV suggestions
      if(uv >= 7) lists.push(lang === 'hi' ? 'UV ‡§â‡§ö‡•ç‡§ö ‚Äî ‡§∏‡§®‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§≤‡§ó‡§æ‡§è‡§Å' : 'UV high ‚Äî apply sunscreen.');
      else if(uv >= 4) lists.push(lang === 'hi' ? 'UV ‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‚Äî ‡§∏‡§®‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç' : 'UV moderate ‚Äî consider sunscreen.');

      // Wind advice
      if(wind_kph >= 40) lists.push(lang === 'hi' ? '‡§§‡•á‡§ú‡§º ‡§π‡§µ‡§æ ‚Äî ‡§¨‡§æ‡§π‡§∞ ‡§∏‡§æ‡§µ‡§ß‡§æ‡§®‡•Ä ‡§∏‡•á ‡§ú‡§æ‡§è‡§Å' : 'Strong winds ‚Äî be careful outdoors.');

      // AQI advice
      if(aqi !== null){
        const aqiVal = Number(aqi);
        if(aqiVal >= 4) lists.push(lang === 'hi' ? '‡§µ‡§æ‡§Ø‡•Å ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§ñ‡§∞‡§æ‡§¨ ‚Äî ‡§¨‡§æ‡§π‡§∞‡•Ä ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø‡§Ø‡§æ‡§Å ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç' : 'Poor air quality ‚Äî limit outdoor activities.');
        else if(aqiVal >= 2) lists.push(lang === 'hi' ? '‡§µ‡§æ‡§Ø‡•Å ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§î‡§∏‡§§ ‚Äî ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§æ‡§µ‡§ß‡§æ‡§®‡•Ä ‡§∞‡§ñ‡•á‡§Ç' : 'Moderate air quality ‚Äî sensitive people take caution.');
      }

      // humidity
      if(humidity >= 85) lists.push(lang === 'hi' ? '‡§®‡§Æ‡•Ä ‡§Ö‡§ß‡§ø‡§ï ‚Äî ‡§π‡§≤‡•ç‡§ï‡§æ ‡§ï‡§™‡§°‡§º‡§æ ‡§™‡§π‡§®‡•á‡§Ç' : 'High humidity ‚Äî wear breathable fabrics.');

      // short friendly summary
      let summary = '';
      if(cond.includes('clear') || cond.includes('sun')) summary = (lang === 'hi' ? '‡§∏‡§æ‡§´‡§º ‡§Ü‡§∏‡§Æ‡§æ‡§®' : 'Clear skies');
      else summary = cur.condition.text || (lang === 'hi' ? '‡§Æ‡•å‡§∏‡§Æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç' : 'Weather info unavailable');

      return { summary, lists };
    }

    /* ============================
       Fetching Weather & Forecast
       ============================ */
    async function fetchWeather(q, {useForecast = true} = {}){
      showLoading(true);
      try{
        // current + forecast 7 days in one call for convenience
        const url = `${BASE_FORECAST}?key=${API_KEY}&q=${encodeURIComponent(q)}&days=7&aqi=yes&alerts=no`;
        const res = await fetch(url);
        if(!res.ok){
          const txt = await res.text();
          throw new Error('Network response not ok: ' + res.status + ' - ' + txt);
        }
        const data = await res.json();
        // render current
        const cur = data.current;
        const loc = data.location;
        document.getElementById('tempC').textContent = Math.round(cur.temp_c) + '¬∞C';
        document.getElementById('conditionText').textContent = cur.condition.text;
        document.getElementById('condIcon').src = 'https:' + cur.condition.icon;
        document.getElementById('localTime').textContent = 'Local time: ' + (loc.localtime || '--');
        document.getElementById('feelslike').textContent = Math.round(cur.feelslike_c) + '¬∞C';
        document.getElementById('humidity').textContent = cur.humidity + '%';
        document.getElementById('wind').textContent = cur.wind_kph + ' kph ' + (cur.wind_dir || '');
        document.getElementById('vis').textContent = (cur.vis_km ?? '--') + ' km';
        document.getElementById('uv').textContent = (cur.uv ?? '--');
        document.getElementById('cloud').textContent = (cur.cloud ?? '--') + '%';
        document.getElementById('locationName').textContent = loc.name + ', ' + loc.region + ' (' + loc.country + ')';
        document.getElementById('lastUpdated').textContent = t('lastUpdatedPrefix') + (cur.last_updated || '--');

        document.getElementById('tz').textContent = loc.tz_id || '--';
        document.getElementById('latlon').textContent = loc.lat + ', ' + loc.lon;
        document.getElementById('region').textContent = loc.region + ' / ' + loc.country;

        // AQI
        const aq = cur.air_quality || null;
        const aqContent = document.getElementById('aqContent');
        aqContent.innerHTML = '';
        if(aq){
          airCard.style.display = 'block';
          const pollutants = {
            'pm2_5': aq['pm2_5'],
            'pm10': aq['pm10'],
            'o3': aq['o3'],
            'no2': aq['no2'],
            'so2': aq['so2'],
            'co': aq['co']
          };
          const aqIndex = aq['us-epa-index'] ?? aq['gb-defra-index'] ?? null;
          let html = '';
          if(aqIndex !== null){
            const color = setAQIColor(aqIndex * 50);
            html += `<div style="display:flex;align-items:center;gap:10px;margin-bottom:8px"><div class="dot" style="background:${color}"></div><div>${t('aqTitle')}: <strong>${aqIndex}</strong></div></div>`;
          }
          html += '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px">';
          for(const k in pollutants){
            const val = pollutants[k];
            html += `<div style="background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;font-size:13px;text-align:center">${k.toUpperCase()}<div style="font-weight:700;margin-top:6px">${val ? val.toFixed(2) : '--'}</div></div>`;
          }
          html += '</div>';
          aqContent.innerHTML = html;
        } else {
          airCard.style.display = 'none';
        }

        // Forecast chart
        if(data.forecast && data.forecast.forecastday){
          const days = data.forecast.forecastday;
          const labels = days.map(d => d.date);
          const maxTemps = days.map(d => d.day.maxtemp_c);
          const minTemps = days.map(d => d.day.mintemp_c);

          if(forecastChart) forecastChart.destroy();
          forecastChart = new Chart(forecastChartCtx, {
            type: 'line',
            data: {
              labels,
              datasets: [
                { label: lang === 'hi' ? 'Max (¬∞C)' : 'Max (¬∞C)', data: maxTemps, tension:0.3, fill:false, borderWidth:2 },
                { label: lang === 'hi' ? 'Min (¬∞C)' : 'Min (¬∞C)', data: minTemps, tension:0.3, fill:false, borderWidth:2 }
              ]
            },
            options: {
              responsive:true,
              plugins:{ legend:{ labels:{ color:'#dbeafe' } } },
              scales: {
                x: { ticks:{ color:'#93c5fd' } },
                y: { ticks:{ color:'#93c5fd' } }
              }
            }
          });
        }

        // Recommendations
        const rec = computeRecommendations(data);
        recommendationsEl.innerHTML = `<strong>${rec.summary}</strong><ul style="margin:8px 0 0 16px;padding:0">${rec.lists.map(it => `<li style="margin:6px 0">${it}</li>`).join('')}</ul>`;
        recommendationsEl.style.display = 'block';

        // animations: choose based on condition words
        const condText = (cur.condition.text || '').toLowerCase();
        const isDay = cur.is_day === 1;
        setDayNight(isDay);
        if(condText.includes('rain') || condText.includes('shower') || condText.includes('drizzle') || condText.includes('thunder')){
          makeRain(80);
        } else if(condText.includes('snow') || condText.includes('sleet') || condText.includes('blizzard')){
          makeSnow(40);
        } else {
          clearAnimations(); // clear for clear/cloud
        }

        mainEl.style.display = 'block';
      } catch(err){
        console.error(err);
        showError((lang==='hi') ? `‡§π‡•ã ‡§®‡§π‡•Ä‡§Ç ‡§™‡§æ‡§Ø‡§æ: ${err.message}` : `Could not fetch weather: ${err.message}`);
      } finally {
        showLoading(false);
      }
    }

    /* ============================
       Form & Buttons
       ============================ */
    form.addEventListener('submit', e =>{
      e.preventDefault();
      const q = input.value.trim();
      if(!q) return;
      fetchWeather(q);
    });

    geoBtn.addEventListener('click', async ()=>{
      showLoading(true, t('useLocation'));
      if(!navigator.geolocation){
        showLoading(false);
        alert(t('geoFail'));
        return;
      }
      navigator.geolocation.getCurrentPosition(pos => {
        const { latitude, longitude } = pos.coords;
        const q = `${latitude},${longitude}`;
        input.value = q;
        fetchWeather(q);
      }, err => {
        console.error(err);
        showLoading(false);
        alert(t('geoFail'));
      }, {timeout:10000});
    });

    /* ============================
       Voice Search (Web Speech API)
       ============================ */
    let recognition = null;
    let recognizing = false;
    function setupSpeech(){
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(!SpeechRecognition) return false;
      recognition = new SpeechRecognition();
      recognition.lang = (lang === 'hi') ? 'hi-IN' : 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.addEventListener('result', (ev) => {
        const text = ev.results[0][0].transcript;
        input.value = text;
        fetchWeather(text);
      });
      recognition.addEventListener('end', () => {
        recognizing = false;
        voiceBtn.classList.remove('speech-active');
        voiceBtn.textContent = 'üéôÔ∏è';
      });
      recognition.addEventListener('start', () => {
        recognizing = true;
        voiceBtn.classList.add('speech-active');
        voiceBtn.textContent = t('listening');
      });
      return true;
    }

    voiceBtn.addEventListener('click', () => {
      if(!recognition){
        if(!setupSpeech()){
          alert(t('voiceNotSupported'));
          return;
        }
      }
      if(recognizing){
        recognition.stop();
        recognizing = false;
        voiceBtn.classList.remove('speech-active');
        voiceBtn.textContent = 'üéôÔ∏è';
      } else {
        recognition.lang = (lang === 'hi') ? 'hi-IN' : 'en-US';
        recognition.start();
      }
    });

    // init speech early if supported
    setupSpeech();

    /* ============================
       Initial load
       ============================ */
    // bring initial translations reflected
    applyTranslations();

    // load default city on start
    fetchWeather(input.value.trim());

    /* ============================
       Notes / Warnings for deployment
       ============================ */
    // 1) If you deploy to GitHub Pages, your API key will be visible in client-side code.
    //    For production, move API calls to a tiny serverless function / proxy to hide the key.
    // 2) WeatherAPI free tier has request limits. Replace API_KEY with your own.
    // 3) You can extend translations object to add more languages.

  </script>
</body>
</html>
